
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Shoreline retreat Aoteroa NZ </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  
  <!-- Leaflet providers (Carto, ESRI, etc.) -->
  <script src="https://unpkg.com/leaflet-providers@1.3.0/leaflet-providers.js"></script>
  
  <!-- Leaflet.sidebar -->
  <link href="https://cdn.jsdelivr.net/npm/leaflet-sidebar-v2@3.2.3/css/leaflet-sidebar.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/leaflet-sidebar-v2@3.2.3/js/leaflet-sidebar.min.js"></script>

  <!-- Font Awesome (for icons in sidebar) -->
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

  <style>
    html, body, #map {
      height: 100%;
      margin: 0;
    }
    .custom-control {
      position: absolute;
      top: 10%;
      left: 10px;
      z-index: 1000;
      background: white;
      padding: 10px;
      border-radius: 5px;
      box-shadow: 0 0 5px rgba(0,0,0,0.3);
      font-family: sans-serif;
      font-size: 14px;
    }
    .custom-control label {
      display: block;
      margin-left: 10px;
    }
    .custom-control .group {
      margin-bottom: 10px;
    }
  </style>
</head>
<body>


  <div id="map"></div>

  <!-- Layer toggles -->
    <div class="custom-control">
      <details>
        <summary><strong>RCP 1.9</strong></summary>
        <label><input type="checkbox" id="layer19_2005"> 2005</label>
        <label><input type="checkbox" id="layer19_2020"> 2020</label>
        <label><input type="checkbox" id="layer19_2030"> 2030</label>
        <label><input type="checkbox" id="layer19_2050"> 2050</label>
        <label><input type="checkbox" id="layer19_2080"> 2080</label>
        <label><input type="checkbox" id="layer19_2100"> 2100</label>        
      </details>
    
      <details>
        <summary><strong>RCP 2.6</strong></summary>
        <label><input type="checkbox" id="layer26_2005"> 2005</label>
        <label><input type="checkbox" id="layer26_2020"> 2020</label>
        <label><input type="checkbox" id="layer26_2030"> 2030</label>
        <label><input type="checkbox" id="layer26_2050"> 2050</label>
        <label><input type="checkbox" id="layer26_2080"> 2080</label>
        <label><input type="checkbox" id="layer26_2100"> 2100</label>
      </details>
      
      <details>
        <summary><strong>RCP 4.5</strong></summary>
        <label><input type="checkbox" id="layer45_2005"> 2005</label>
        <label><input type="checkbox" id="layer45_2020"> 2020</label>
        <label><input type="checkbox" id="layer45_2030"> 2030</label>
        <label><input type="checkbox" id="layer45_2050"> 2050</label>
        <label><input type="checkbox" id="layer45_2080"> 2080</label>
        <label><input type="checkbox" id="layer45_2100"> 2100</label>
      </details>
       
      <details>
        <summary><strong>RCP 7</strong></summary>
        <label><input type="checkbox" id="layer70_2005"> 2005</label>
        <label><input type="checkbox" id="layer70_2020"> 2020</label>
        <label><input type="checkbox" id="layer70_2030"> 2030</label>
        <label><input type="checkbox" id="layer70_2050"> 2050</label>
        <label><input type="checkbox" id="layer70_2080"> 2080</label>
        <label><input type="checkbox" id="layer70_2100"> 2100</label>
     </details>

      <details>
        <summary><strong>RCP 8.5</strong></summary>
        <label><input type="checkbox" id="layer85_2005"> 2005</label>
        <label><input type="checkbox" id="layer85_2020"> 2020</label>
        <label><input type="checkbox" id="layer85_2030"> 2030</label>
        <label><input type="checkbox" id="layer85_2050"> 2050</label>
        <label><input type="checkbox" id="layer85_2080"> 2080</label>
        <label><input type="checkbox" id="layer85_2100"> 2100</label>
     </details>

    </div>
      
  <!-- Sidebar -->
  <div id="sidebar" class="leaflet-sidebar collapsed">
    <div class="leaflet-sidebar-tabs">
      <ul role="tablist">
        <li><a href="#home" role="tab"><i class="fa fa-bars"></i></a></li>
        <li><a href="https://github.com/eduardogomezdelapena/OCC_Retreat_Modelling"><i class="fa fa-github"></i></a></li>
      </ul>
    </div>

    <div class="leaflet-sidebar-content">
      <div class="leaflet-sidebar-pane" id="home">
        <div id="attribution">

          <p> Shoreline retreat projections for Aotearoa New Zealand. Data processed by Eduardo Gomez-de la Pena. Retreat was estimated using the Bruun rule, see <a href="https://github.com/eduardogomezdelapena/OCC_Retreat_Modelling/blob/main/README.md">README</a> for more information.</p>
          <p> This work is part of  <a href="https://searise.nz/">Our Changing Coasts</a> MBIE project, funded secured by Dr. Giovanni Coco and Dr. Karin Bryan, The University of Auckland. </p>

          <p><a href="https://uoa-eresearch.github.io/CoastSat/">NZ shoreline data</a> processed by Nick Young using the <a href="https://github.com/kvos/CoastSat/"> CoastSat </a> toolbox and the NIWA Tide API. Shorelines corrected to MSL.</p>
          <p>Sea-Level Rise projections taken from the <a href="https://searise.takiwa.co/map/"> the NZ SeaRise</a> : Te Tai Pari O Aotearoa programme. </p>

        </div>
      </div>
    </div>
  </div>

  <script>
  
    const map = L.map('map').setView([-41, 178], 6);
    
    // Sidebar
    var sidebar = L.control.sidebar({
      autopan: false,
      closeButton: true,
      container: 'sidebar',
      position: 'right'
    }).addTo(map);

    // Open the "home" tab by default
    sidebar.open('home');


    // Basemaps
    var baseMaps = {
      "ESRI Imagery": L.tileLayer.provider("Esri.WorldImagery").addTo(map),
      "ESRI Topo": L.tileLayer.provider("Esri.WorldTopoMap"),
      "CartoDB Positron": L.tileLayer.provider("CartoDB.Positron"),
      "CartoDB Dark": L.tileLayer.provider("CartoDB.DarkMatter"),
      "OpenStreetMap": L.tileLayer.provider("OpenStreetMap.Mapnik")
    };
    
    L.control.layers(baseMaps, null, { position: 'bottomleft' }).addTo(map);

    //Legend
    
 const legend = L.control({ position: 'bottomright' });

legend.onAdd = function(map) {
  const div = L.DomUtil.create('div', 'info legend');
  div.style.backgroundColor = 'white';
  div.style.padding = '6px 8px';
  div.style.fontSize = '14px';
  div.style.borderRadius = '5px';
  div.style.boxShadow = '0 0 15px rgba(0,0,0,0.2)';
  div.innerHTML = '<strong>Retreat (m)</strong><br>';

  const grades = [0, 5, 10];
  const colors = ['#1a9850', '#fee08b', '#d73027']; // green, yellow, red

  for (let i = 0; i < grades.length; i++) {
    const from = grades[i];
    const to = grades[i + 1];

    const rangeText = to ? `${from} &ndash; ${to}` : `${from}+`;

    div.innerHTML +=
      `<i style="background:${colors[i]}; width: 18px; height: 18px; display: inline-block; margin-right: 8px; opacity: 0.7;"></i> ${rangeText}<br>`;
  }

  return div;
};

legend.addTo(map);

    // Color + radius
    function getColor(value) {
      return value > 10 ? '#d73027' :
             value > 5  ? '#fee08b' :
                          '#1a9850';
    }

    function getRadius(value) {
      return Math.max(4, value * 0.8);
    }

    // Track loaded layers
    const layers = {
      layer19_2005: { url: 'retreat_1.9_2005_50percentile.geojson', layer: null },
      layer19_2020: { url: 'retreat_1.9_2020_50percentile.geojson', layer: null },
      layer19_2030: { url: 'retreat_1.9_2030_50percentile.geojson', layer: null },
      layer19_2050: { url: 'retreat_1.9_2050_50percentile.geojson', layer: null },
      layer19_2080: { url: 'retreat_1.9_2080_50percentile.geojson', layer: null },
      layer19_2100: { url: 'retreat_1.9_2100_50percentile.geojson', layer: null },      
      
      layer26_2005: { url: 'retreat_2.6_2005_50percentile.geojson', layer: null },
      layer26_2020: { url: 'retreat_2.6_2020_50percentile.geojson', layer: null },
      layer26_2030: { url: 'retreat_2.6_2030_50percentile.geojson', layer: null },
      layer26_2050: { url: 'retreat_2.6_2050_50percentile.geojson', layer: null },
      layer26_2080: { url: 'retreat_2.6_2080_50percentile.geojson', layer: null },
      layer26_2100: { url: 'retreat_2.6_2100_50percentile.geojson', layer: null },
      
      layer45_2005: { url: 'retreat_4.5_2005_50percentile.geojson', layer: null },
      layer45_2020: { url: 'retreat_4.5_2020_50percentile.geojson', layer: null },
      layer45_2030: { url: 'retreat_4.5_2030_50percentile.geojson', layer: null },
      layer45_2050: { url: 'retreat_4.5_2050_50percentile.geojson', layer: null },
      layer45_2080: { url: 'retreat_4.5_2080_50percentile.geojson', layer: null },
      layer45_2100: { url: 'retreat_4.5_2100_50percentile.geojson', layer: null },

      layer70_2005: { url: 'retreat_7_2005_50percentile.geojson', layer: null },
      layer70_2020: { url: 'retreat_7_2020_50percentile.geojson', layer: null },
      layer70_2030: { url: 'retreat_7_2030_50percentile.geojson', layer: null },
      layer70_2050: { url: 'retreat_7_2050_50percentile.geojson', layer: null },
      layer70_2080: { url: 'retreat_7_2080_50percentile.geojson', layer: null },
      layer70_2100: { url: 'retreat_7_2100_50percentile.geojson', layer: null },

      layer85_2005: { url: 'retreat_8.5_2005_50percentile.geojson', layer: null },
      layer85_2020: { url: 'retreat_8.5_2020_50percentile.geojson', layer: null },
      layer85_2030: { url: 'retreat_8.5_2030_50percentile.geojson', layer: null },
      layer85_2050: { url: 'retreat_8.5_2050_50percentile.geojson', layer: null },
      layer85_2080: { url: 'retreat_8.5_2080_50percentile.geojson', layer: null },
      layer85_2100: { url: 'retreat_8.5_2100_50percentile.geojson', layer: null }      
      
    };

    function loadAndToggleLayer(key, checked) {
      const entry = layers[key];

      if (checked) {
        if (entry.layer) {
          // Already loaded, just add to map
          map.addLayer(entry.layer);
        } else {
          // Lazy-load GeoJSON
          fetch(entry.url)
            .then(res => res.json())
            .then(data => {
              entry.layer = L.geoJSON(data, {
                pointToLayer: (feature, latlng) => {
                  const retreat = feature.properties.retreat_50;
                  return L.circleMarker(latlng, {
                    radius: getRadius(retreat),
                    fillColor: getColor(retreat),
                    color: '#000',
                    weight: 1,
                    opacity: 1,
                    fillOpacity: 0.8
                  });
                },
                onEachFeature: (feature, layer) => {
                  const name = feature.properties.name;
                  const retreat = feature.properties.retreat_50;
                  layer.bindPopup(`<strong>${name}</strong><br>Retreat (50th percentile): ${retreat} m`);
                }
              });

              entry.layer.addTo(map);

            });
        }
      } else {
        // Turn off layer if it's loaded
        if (entry.layer && map.hasLayer(entry.layer)) {
          map.removeLayer(entry.layer);
        }
      }
    }

    // Attach checkbox listeners
    Object.keys(layers).forEach(key => {
      const checkbox = document.getElementById(key);
      checkbox.addEventListener('change', (e) => {
        loadAndToggleLayer(key, e.target.checked);
      });
    });
  </script>
</body>
</html>

